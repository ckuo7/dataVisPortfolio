<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>MSAN 622 Homework2</title>

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/bootstrap-theme.min.css" rel="stylesheet">

<style type="text/css">
    body {
        padding-top: 50px;
        padding-bottom: 20px;
    }
</style>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/d3.min.js"></script>
</head>

<body>
<!-- Fixed Navbar -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../index.html">MSAN 622</a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="#homework">Homework</a></li>
                <li><a href="#project">Project</a></li>
                <li><a href="#participation">Participation</a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right">
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>

<div class = "container"></div>
<div>
    <h2><a href="https://public.tableau.com/views/prototype_0/Dashboard1?:embed=y&:showTabs=y&:display_count=yes">Prototype</a></h2>
</div>
<style>
    svg {
    background-color: white;
    margin: 1px;
    float: left;
    }

.inner {
    width: 1600px;
    height: 600px;
    overflow: auto;
}
#dashboard{
    width: 1600px;
    height: 1600px;
    overflow: scroll;
}
path.slice{
	stroke-width:2px;
}
polyline{
	opacity: .3;
	stroke: black;
	stroke-width: 2px;
	fill: none;
}
</style>
<div id="chart1" class="inner">
    <script>
        var select = document.createElement("select");
        select.setAttribute("id","selectYear");
        var dropDownList = document.getElementById("chart1");
        dropDownList.appendChild(select);
        d3.csv('../data/moviesYear.csv', function(d){ return d.year;}, function(error,data){
            data.forEach( function(d){

                var option = document.createElement("option");

                option.setAttribute("value",d);
                var textnode = document.createTextNode(d);
                option.appendChild(textnode);
                select.appendChild(option);
            });
            console.log(select);
//            dropDownList.appendChild(select);
        })
    </script>
    <select name="tpi" id="genre">
        <option selected="selected" value="none">none</option>
        <option value="action">action</option>
        <option value="animation">animation</option>
        <option value="comedy">comedy</option>
        <option value="drama">drama</option>
        <option value="documentary">documentary</option>
        <option value="romance">romance</option>
        <option value="short">short</option>
      </select>
    <script>



    var margin = {top: 40, right: 20, bottom: 30, left: 40},
        width = 500 - margin.left - margin.right,
        height = 6000 - margin.top - margin.bottom,
        radius = 180;

    var svg = d3.select("#chart1").append('svg').attr("width",1600);
//            .attr("height", (height + margin.top + margin.left));

    var frameRect = d3.select('svg').append('rect').attr('width',1600).style("fill","none").style("stroke","gray");

    var chart1 = d3.select('svg').append('g').attr("id","barGroup");

    var xScale = d3.scale.linear().range([0, width]).domain([0,10]);

    var xAxis = d3.svg.axis().scale(xScale).orient("top").ticks(10);

    var xGuide = chart1.append("g").attr("class", "x axis").attr("id", "axis").call(xAxis);
    xGuide.selectAll('line').style({"fill": "none", "stroke": "black"});
    xGuide.selectAll('path').style({"fill": "none", "stroke": "black"});


    var movieData = [];
    var uniqueYear = [];

    var donut = svg.append("g");

    donut.append("g").attr("class", "slices");
    donut.append("g").attr("class", "labels");
    donut.append("g").attr("class", "lines");

    var pie = d3.layout.pie()
	    .sort(null)
	    .value(function(d) {
		    return d.value;
	        });

    var arc = d3.svg.arc()
	    .outerRadius(radius * 0.8)
	    .innerRadius(radius * 0.4);

    var outerArc = d3.svg.arc()
	    .innerRadius(radius * 0.9)
	    .outerRadius(radius * 0.9);

    donut.attr("transform", "translate(300,360)");

    var key = function(d){
        console.log(d);
        return d.data.label; };

    var color = d3.scale.ordinal()
	    .domain(["action","animation","comedy","drama","documentary","romance","short"])
	    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

//function randomData (){
//	var labels = color.domain();
//	return labels.map(function(label){
//		return { label: label, value: Math.random() }
//	});
//}

    d3.csv("./data/movieGenreYear.csv",
        function(d){
                return {
                    "year": +d.year,
                    "action": +d.action,
                    "animation": +d.animation,
                    "comedy": +d.comedy,
                    "drama": +d.drama,
                    "documentary": +d.documentary,
                    "romance": +d.romance,
                    "short": +d.short,
                    "sum" : +d.sum };
        },
        function(error,data){

            var data_ = [];
            var sum_ = null;
            data.forEach(function(d){
                if(d.year===2005){
                    console.log(d);
                    data_.push({"label":"action","value":d.action});
                    data_.push({"label":"animation","value":d.animation});
                    data_.push({"label":"comedy","value":d.comedy});
                    data_.push({"label":"drama","value": d.drama});
                    data_.push({"label":"documentary","value":d.documentary});
                    data_.push({"label":"romance","value":d.romance});
                    data_.push({"label":"short","value":d.short});
                    sum_ = d.sum;}});

//            console.log(data_);
//            console.log(sum_);


            console.log(error);
            console.log(pie(data_));

            var slice = donut.select(".slices").selectAll("path.slice").data(pie(data_), key);
//            console.log(slice);

            slice.enter()
                .insert("path")
                .style("fill", function(d) { return color(d.data.label); })
                .attr("class", "slice");

            slice.transition().duration(1000)
                .attrTween("d", function(d) {
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function(t) {
                        return arc(interpolate(t));
                    };
                });

        	slice.exit().remove();


            var text = donut.select(".labels").selectAll("text")
		        .data(pie(data_), key);

            text.enter()
                .append("text")
                .attr("dy", ".35em")
                .text(function(d) {
                    return d.data.label;
                });

            function midAngle(d){
                return d.startAngle + (d.endAngle - d.startAngle)/2;
            }

            text.transition().duration(1000)
                .attrTween("transform", function(d) {
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function(t) {
                        var d2 = interpolate(t);
                        var pos = outerArc.centroid(d2);
                        pos[0] = radius * (midAngle(d2) < Math.PI ? 1 : -1);
                        return "translate("+ pos +")";
                    };
                })
                .styleTween("text-anchor", function(d){
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function(t) {
                        var d2 = interpolate(t);
                        return midAngle(d2) < Math.PI ? "start":"end";
                    };
                });

            text.exit()
                .remove();


            var polyline = donut.select(".lines").selectAll("polyline")
                .data(pie(data_), key);

            polyline.enter()
                .append("polyline");

            polyline.transition().duration(1000)
                .attrTween("points", function(d){
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function(t) {
                        var d2 = interpolate(t);
                        var pos = outerArc.centroid(d2);
                        pos[0] = radius * 0.95 * (midAngle(d2) < Math.PI ? 1 : -1);
                        return [arc.centroid(d2), outerArc.centroid(d2), pos];
                    };
                });

            polyline.exit()
                .remove();

        }
    );


    function plotBar() {

        d3.selectAll(".bar").remove();
        d3.select("#yAxis").remove();
//        var chart1 = d3.select('svg').append('g').attr("id","barGroup");
        d3.csv("./data/moviesWhole.csv",

                function (d) {

                    return {
                        "title": d.title,
                        "year": +d.year,
                        "length": +d.Length,
                        "budget": +d.budget,
                        "mpaa": d.mpaa,
                        "votes": +d.votes,
                        "rating": +d.rating,
                        "action": +d.Action,
                        "animation": +d.Animation,
                        "comedy": +d.Comedy,
                        "drama": +d.Drama,
                        "documentary": +d.Documentary,
                        "romance": +d.Romance,
                        "short": +d.Short
                    };
                },

                function (error, data) {
                    console.log(error);

//                    console.log(document.getElementById("selectYear").value);
                    var sYear = +document.getElementById("selectYear").value;
                    var mGenre = document.getElementById("genre").value;
                    console.log(sYear);
                    console.log(mGenre);

                    var data_ = [];

                    if (mGenre === "none") {
                        data.forEach(function (d) {
                            if (d.year === sYear) {
                                data_.push(d);
                            }
                        });
                    }
                    else{
                        data.forEach(function (d) {
                            if (d.year === sYear && d[mGenre] === 1) {
                                data_.push(d);
                            }
                        });

                    }


                    var sortData_ = data_.sort(function (a, b) {
                        return a.rating - b.rating;}).reverse();
                    var numOfMovies = sortData_.length;

                    console.log(numOfMovies);
                    var height_ = numOfMovies*30;
                    svg.attr("height",height_);
                    frameRect.attr('height',height_);
                    var yScale = d3.scale.ordinal().rangeBands([0, height_],.1,.3);
                    var yAxis = d3.svg.axis().scale(yScale).orient("left");


                    var leftmargin = d3.max(sortData_, function (d) {
                        return d.title.length;
                    });
//                    console.log(leftmargin);
                    chart1.attr("transform", "translate(" + (leftmargin * 6 + margin.left + 480) + "," + margin.top + ")");

//                    console.log(sortData_);

                    yScale.domain(sortData_.map(function (d) {
                        return d.title;
                    }));
                    chart1.selectAll('rect').data(sortData_).enter().append("rect")
                            .attr('class', "bar")
                            .attr("x", 0)
                            .attr("y", function (d) {
                                return yScale(d.title);
                            })
                            .attr("width", 0)
//                    .attr("width",function(d){
//                        console.log(xScale(d.rating));
//                        return xScale(d.rating);})
                            .attr("height", yScale.rangeBand())
                            .style("fill", "steelblue");

                    d3.selectAll(".bar").data(sortData_)
                            .transition().duration(400).delay(function (d, i) {
                                return 50 * i;
                            })
                            .attr("width", function (d) {
                                return xScale(d.rating);
                            });
//            })
//            .attr("y", function (d) {
//                return (y(d.frequency))
//            });




                    var yGuide = chart1.append("g")
                            .attr("class", "y axis")
                            .attr("id", "yAxis")
                            .call(yAxis);


                    yGuide.selectAll('line').style({"fill": "none", "stroke": "none"});
                    yGuide.selectAll('path').style({"fill": "none", "stroke": "none"});


//            console.log(uniqueYear);
////            data.forEach(function(d){
////
////                movieData.push(d);})
//            var years = {};
//            for (var i = 0; i < year.length; i++) {
//                if (year[i] in years) {years[year[i]]++;}
//                else {years[year[i]] = 1;}}
//
//            uniqueYear = Object.keys(years).sort().reverse();
//            console.log(uniqueYear);
//
//            uniqueYear.forEach( function(d){
//
//                var option = document.createElement("option");
//
//                        option.setAttribute("value",d);
//                var textnode = document.createTextNode(d);
//                        option.appendChild(textnode);
//                select.appendChild(option);
//            });
//            console.log(select);
//            dropDownList.appendChild(select);

                });
    }

        document.getElementById("selectYear").onchange = plotBar;
        document.getElementById("genre").onchange = plotBar;
        plotBar()
    </script>
</div>

</body>