<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>MSAN 622 Homework2</title>

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/bootstrap-theme.min.css" rel="stylesheet">

<style type="text/css">
    body {
        padding-top: 50px;
        padding-bottom: 20px;
    }
</style>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/d3.min.js"></script>
</head>

<body>
<!-- Fixed Navbar -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../index.html">MSAN 622</a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="#homework">Homework</a></li>
                <li><a href="#project">Project</a></li>
                <li><a href="#participation">Participation</a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right">
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>

<div class = "container"></div>
<div>
    <h2><a href="https://public.tableau.com/views/prototype_0/Dashboard1?:embed=y&:showTabs=y&:display_count=yes">Prototype</a></h2>
</div>
<style>
    svg {
    background-color: white;
    margin: 1px;
    float: left;
    }

.inner {
    width: 1600px;
    height: 600px;
    overflow: auto;
}
#dashboard{
    width: 1600px;
    height: 1600px;
    overflow: scroll;
}
</style>
<div id="chart1" class="inner">
    <script>
        var select = document.createElement("select");
        select.setAttribute("id","selectYear");
        var dropDownList = document.getElementById("chart1");
        dropDownList.appendChild(select);
        d3.csv('../data/moviesYear.csv', function(d){ return d.year;}, function(error,data){
            data.forEach( function(d){

                var option = document.createElement("option");

                option.setAttribute("value",d);
                var textnode = document.createTextNode(d);
                option.appendChild(textnode);
                select.appendChild(option);
            });
            console.log(select);
//            dropDownList.appendChild(select);
        })
    </script>
    <select name="tpi" id="genre">
        <option selected="selected" value="none">none</option>
        <option value="action">action</option>
        <option value="animation">animation</option>
        <option value="comedy">comedy</option>
        <option value="drama">drama</option>
        <option value="documentary">documentary</option>
        <option value="romance">romance</option>
        <option value="short">short</option>
      </select>
    <script>



    var margin = {top: 40, right: 20, bottom: 30, left: 40},
        width = 500 - margin.left - margin.right,
        height = 6000 - margin.top - margin.bottom;

    var svg = d3.select("#chart1").append('svg').attr("width",1600);
//            .attr("height", (height + margin.top + margin.left));

    var frameRect = d3.select('svg').append('rect').attr('width',1600).style("fill","none").style("stroke","gray");

    var chart1 = d3.select('svg').append('g').attr("id","barGroup");

    var xScale = d3.scale.linear()
            .range([0, width]).domain([0,10]);
    // .domain(wordList.map(function(d){return d.letter;}));
    // .rangeRoundBands([0, width], .1, 1)
    // .rangeRoundBands([0, width], .1,.2)


    // .domain([0, d3.max(wordList, function(d){return d.frequency;})]);

    var xAxis = d3.svg.axis()
            .scale(xScale)
            .orient("top").ticks(10);


//            .ticks(d3.max(wordList, function (d) {
//                return d.frequency
//            }));
    // .tickFormat(formatPercent);
    var xGuide = chart1.append("g")
                            .attr("class", "x axis")
                            .attr("id", "axis")
                            .call(xAxis);
    xGuide.selectAll('line').style({"fill": "none", "stroke": "black"});
    xGuide.selectAll('path').style({"fill": "none", "stroke": "black"});


    var movieData = [];
    var uniqueYear = [];

    function plotBar() {

        d3.selectAll(".bar").remove();
        d3.select("#yAxis").remove();
//        var chart1 = d3.select('svg').append('g').attr("id","barGroup");
        d3.csv("./data/moviesWhole.csv",

                function (d) {

                    return {
                        "title": d.title,
                        "year": +d.year,
                        "length": +d.Length,
                        "budget": +d.budget,
                        "mpaa": d.mpaa,
                        "votes": +d.votes,
                        "rating": +d.rating,
                        "action": +d.Action,
                        "animation": +d.Animation,
                        "comedy": +d.Comedy,
                        "drama": +d.Drama,
                        "documentary": +d.Documentary,
                        "romance": +d.Romance,
                        "short": +d.Short
                    };
                },

                function (error, data) {
                    console.log(error);

//                    console.log(document.getElementById("selectYear").value);
                    var sYear = +document.getElementById("selectYear").value;
                    var mGenre = document.getElementById("genre").value;
                    console.log(sYear);
                    console.log(mGenre);

                    var data_ = [];

                    if (mGenre === "none") {
                        data.forEach(function (d) {
                            if (d.year === sYear) {
                                data_.push(d);
                            }
                        });
                    }
                    else{
                        data.forEach(function (d) {
                            if (d.year === sYear && d[mGenre] === 1) {
                                data_.push(d);
                            }
                        });

                    }


                    var sortData_ = data_.sort(function (a, b) {
                        return a.rating - b.rating;}).reverse();
                    var numOfMovies = sortData_.length;

                    console.log(numOfMovies);
                    var height_ = numOfMovies*30;
                    svg.attr("height",height_);
                    frameRect.attr('height',height_);
                    var yScale = d3.scale.ordinal().rangeBands([0, height_],.1,.3);
                    var yAxis = d3.svg.axis().scale(yScale).orient("left");


                    var leftmargin = d3.max(sortData_, function (d) {
                        return d.title.length;
                    });
                    console.log(leftmargin);
                    chart1.attr("transform", "translate(" + (leftmargin * 6 + margin.left) + "," + margin.top + ")");

                    console.log(sortData_);

                    yScale.domain(sortData_.map(function (d) {
                        return d.title;
                    }));
                    chart1.selectAll('rect').data(sortData_).enter().append("rect")
                            .attr('class', "bar")
                            .attr("x", 0)
                            .attr("y", function (d) {
                                return yScale(d.title);
                            })
                            .attr("width", 0)
//                    .attr("width",function(d){
//                        console.log(xScale(d.rating));
//                        return xScale(d.rating);})
                            .attr("height", yScale.rangeBand())
                            .style("fill", "steelblue");

                    d3.selectAll(".bar").data(sortData_)
                            .transition().duration(400).delay(function (d, i) {
                                return 50 * i;
                            })
                            .attr("width", function (d) {
                                return xScale(d.rating);
                            });
//            })
//            .attr("y", function (d) {
//                return (y(d.frequency))
//            });




                    var yGuide = chart1.append("g")
                            .attr("class", "y axis")
                            .attr("id", "yAxis")
                            .call(yAxis);


                    yGuide.selectAll('line').style({"fill": "none", "stroke": "none"});
                    yGuide.selectAll('path').style({"fill": "none", "stroke": "none"});


//            console.log(uniqueYear);
////            data.forEach(function(d){
////
////                movieData.push(d);})
//            var years = {};
//            for (var i = 0; i < year.length; i++) {
//                if (year[i] in years) {years[year[i]]++;}
//                else {years[year[i]] = 1;}}
//
//            uniqueYear = Object.keys(years).sort().reverse();
//            console.log(uniqueYear);
//
//            uniqueYear.forEach( function(d){
//
//                var option = document.createElement("option");
//
//                        option.setAttribute("value",d);
//                var textnode = document.createTextNode(d);
//                        option.appendChild(textnode);
//                select.appendChild(option);
//            });
//            console.log(select);
//            dropDownList.appendChild(select);

                });
    }
//console.log(movieData);

//        var uniqueYear = movieData.map(function(d){
//            console.log(d);
//            return d.year;});
//        console.log(uniqueYear)
        document.getElementById("selectYear").onchange = plotBar;
        document.getElementById("genre").onchange = plotBar;
        plotBar()
    </script>
</div>

</body>