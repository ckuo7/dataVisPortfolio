<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>MSAN 622 Homework2</title>

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/bootstrap-theme.min.css" rel="stylesheet">

<style type="text/css">
    body {
        padding-top: 50px;
        padding-bottom: 20px;
    }
</style>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/d3.min.js"></script>
</head>


<body>
<!-- Fixed Navbar -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/index.html">MSAN 622</a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="#homework">Homework</a></li>
                <li><a href="#project">Project</a></li>
                <li><a href="#participation">Participation</a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right">
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>

<div class = "container">
		<h2>Homework2</h2>
		<ul>
            <li><h4>Bubble Chart</h4></li>
        </ul>
        <div id="chart" width="1000" height="640">
            <script>
// ploting variable
var margin = {"left":80,"top":40,"right":30,"bottom":30};
var width = 800;
var height = 500;
var frameWidth = width + margin.left + margin.right;
var frameHeight = height + margin.top + margin.bottom;
//data

//console.log("after data");
//console.log(data);
//plot element
var radius = 20;
var svg1 = d3.select("#chart").append("svg").attr("width", frameWidth).attr("height",frameHeight).attr('class','frame'); //create frame
//var plot1 = svg1.append("svg").attr('width',width).attr('height',height).attr("transform", "translate(" + margin.left + "," + margin.top + ")").attr('class','plot');



var xScale = d3.scale.linear().range([0,width]);
var yScale = d3.scale.linear().range([height,0]);
var rScale = d3.scale.linear().range([0,radius]);

var xAxis = d3.svg.axis().scale(xScale).orient("bottom");
var yAxis = d3.svg.axis().scale(yScale).orient("left");


//console.log("fefef"data);
d3.csv("homework2/stateX77.csv",function(d){
    return {
        'stateName' : d.stateName,
        'stateAbb' : d.stateAbb,
        'population' : +d.population,
        'Income' : +d.Income,
        'illiteracy' : +d.illiteracy,
        'lifeExp' : +d.lifeExp,
        'murder' : +d.murder,
        'hsGrad' : +d.hsGrad,
        'frost' : +d.frost,
        'area' : +d.area,
        'stateRegion' : d.stateRegion,
        'stateDivision' : d.stateDivision };

        },function(error, rows){
          // code to generate chart goes here

            console.log( rows );

    var min1 = d3.min(rows, function(d){ return d.hsGrad;});
    var max1 = d3.max(rows, function(d){ return d.hsGrad;});

    console.log(min1);
    var min2 = d3.min(rows, function(d){ return d.lifeExp;});
    var max2 = d3.max(rows, function(d){ return d.lifeExp;});

    var percent = 0.06;
    xScale.domain([ min1 - percent * (max1 - min1), max1 + percent * (max1 - min1)]);
    yScale.domain([ min2 - percent * (max2 - min2) , max2 + percent * (max2 - min2)]);

    rScale.domain([d3.min(rows, function(d){return Math.sqrt(d.Income);}),d3.max(rows, function(d){return Math.sqrt(d.Income);})]);
    var circles = svg1.selectAll("circle").data(rows).enter().append("circle")
        .attr("cx", function(d){return xScale(d.hsGrad);})
        .attr("cy", function(d){return height - yScale(d.lifeExp);})
        .attr("r",  function(d){return rScale(Math.sqrt(d.Income));})
        .attr("transform", "translate(" + margin.left + ",0)")
        .style('fill','blue').style("fill-opacity",0.4)
        .on("mouseover", function (d) {

                d3.select(this).style('fill', "#FD8D3C").style('fill-opacity',0.9);

                var xPosition = parseFloat(d3.select(this).attr("cx")) + margin.left ;
                var yPosition = parseFloat(d3.select(this).attr("cy")) - 10;

                d3.select('.frame').append("text").attr("transform","translate(" + margin.left + ",0)")
                        .attr("id", "tooltip")
                        .attr("x", xPosition)
                        .attr("y", yPosition)
                        .attr("text-anchor", "middle")
                        .attr("font-family", "sans-serif")
                        .attr("font-size", "14px")
                        .attr("font-weight", "bold")
                        .attr("fill", "black")
                        .text(d.stateAbb + ",( " +d.hsGrad + " , " + d.lifeExp + " )"); })
            .on("mouseout", function(d){

                d3.select(this).style("fill","blue").style("fill-opacity",0.4);
                d3.select("#tooltip").remove(); // end of style
            });


    var xGuide = svg1.append("g").attr("class", "Axis").attr("id","xAxis").attr("transform", "translate(" + margin.left + "," + height + ")").call(xAxis);
    var yGuide = svg1.append("g").attr("class", "Axis").attr("id","yAxis").attr("transform", "translate(" + margin.left + ",0)").call(yAxis);

    yGuide.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", -70).attr("x",-height/2 + 80)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text("Life Expectency (year)");

    xGuide.append("text").attr("x", width/2 + 130).attr("y", 50)
            .style("text-anchor", "end")
            .text("High School Graduates \n(percentage)");


    xGuide.selectAll('line').style('fill',"none").style("stroke","black");
    xGuide.selectAll('path').style('fill',"none").style("stroke","black");
    yGuide.selectAll('line').style("fill","none").style("stroke","black");
    yGuide.selectAll('path').style("fill","none").style("stroke","black");


});
            </script>
        </div>
        <ul>
            <li><h4>Heatmap</h4></li>
        </ul>
        <div id="chart1" width="1200" height="640">
            <script>


var margin2 = {"left":150,"top":40,"right":120,"bottom":30};
var frameWidth2 = width + margin2.left + margin2.right;
var frameHeight2 = height + margin2.top + margin2.bottom;

var svg2 = d3.select("#chart1").append("svg").attr("width", frameWidth2).attr("height",frameHeight2).attr('class','frame'); //create frame

var xScale2 = d3.scale.ordinal().rangeBands([0,width],0,0);
var yScale2 = d3.scale.ordinal().rangeBands([height,0],0,0);
var zScale2 = d3.scale.linear().range(["white","steelblue"]);

var xAxis2 = d3.svg.axis().scale(xScale2).orient("bottom");
var yAxis2 = d3.svg.axis().scale(yScale2).orient("left");




d3.csv("homework2/stateX77aggregate.csv",function(d){
    return {

        'stateRegion' : d.stateRegion,
        'illiteracyRange': d.illiteracyRange,
        'count' : d.x};

        },function(error, rows) {
    // code to generate chart goes here

    xScale2.domain(rows.map(function(d){ return d.illiteracyRange ; }));
    yScale2.domain(rows.map(function(d){ return d.stateRegion ; }));
//    zScale2.domain( d3.extent(function(d){ return d.count; }));
    zScale2.domain( [0, d3.max(rows, function(d){ return d.count; })]);

    var xGuide2 = svg2.append('g').attr("class","xAxis2").attr("transform","translate(" + margin2.left + "," + height + ")").call(xAxis2);
    var yGuide2 = svg2.append('g').attr("class","yAxis2").attr("transform","translate(" + margin2.left + ",0)").call(yAxis2);

    xGuide2.selectAll("line").style("fill","none");
    xGuide2.select("path").style("fill","none").style("stroke","black");
    yGuide2.selectAll("line").style("fill","none");
    yGuide2.select("path").style("fill","none").style("stroke","black");
    console.log(rows);


    svg2.selectAll(".tile").data(rows).enter().append("rect").attr("class","tile").attr("transform","translate("+ margin2.left + ",0)")
            .attr("x", function(d){return xScale2(d.illiteracyRange);})
            .attr("y", function(d){ return yScale2(d.stateRegion);})
            .style("fill", function(d){ return zScale2(d.count);})
            .attr("width", xScale2.rangeBand())
            .attr("height", yScale2.rangeBand());


    var temp = rows.map(function(d){ return d.count});
    var oTemp = {};
    for ( var i = 0; i < temp.length ; i++ ){ oTemp[temp[i]] = 0;}
    console.log(Object.keys(oTemp));

    var legend = svg2.selectAll(".legend")
      .data(Object.keys(oTemp).reverse())
    .enter().append("g")
      .attr("class", "legend")
      .attr("transform", function(d, i) { return "translate(" + (width + margin.left + 120) + "," + ( margin.top + 50 + i * 20) + ")"; });

    legend.append("rect")
      .attr("width", 20)
      .attr("height", 20)
      .style("fill", zScale2);

    legend.append("text")
      .attr("x", 26)
      .attr("y", 10)
      .attr("dy", ".35em")
      .text(String);

    svg2.append("text")
            .attr("transform", "translate(" + (width + margin.left + 120) + "," + ( margin.top + 50) + ")")
            .attr("x",-20)
            .attr("y",-10)
            .text("State Count");

});

            </script>
        </div>

        <ul>
            <li><h4>Small Multiple (Murder Rate By State Division)</h4></li>
        </ul>
        <div id="chart2" width="2200" height="640">
            <script>


var margin3 = {"left":30,"top":200,"right":20,"bottom":50};
var extra = 500;
var frameWidth3 = width + margin3.left + margin3.right + extra;
var frameHeight3 = height + margin3.top + margin3.bottom + extra;


var submargin = {"left":30,"top":30,"right":30,"bottom":30};
var subwidth = 240;
var subheight = 260;
var marginRatio = 1.2;

var svg3 = d3.select("#chart2").append("svg").attr("width", frameWidth3).attr("height",frameHeight3).attr('class','frame'); //create frame

var stateDivision = {"East South Central":0, "Pacific":1, "Mountain":2, "West South Central":3, "New England":4, "South Atlantic":5, "East North Central":6,"West North Central":7, "Middle Atlantic":8};

var stateDivisionArray = [  {"division":"East South Central","state":[]},
                            {"division":"Pacific","state":[]},
                            {"division":"Mountain","state":[]},
                            {"division":"West South Central","state":[]},
                            {"division":"New England","state":[]},
                            {"division":"South Atlantic","state":[]},
                            {"division":"East North Central","state":[]},
                            {"division":"West North Central","state":[]},
                            {"division":"Middle Atlantic","state":[]}];
var divisionCount = [1,2,3,4,5,6,7,8,9];

//console.log("svgGroup");
//console.log(svgGroup);

var xScaleArray = [];
var yScaleArray = [];

svg3.append("text").attr("y",frameHeight3-margin3.top + 100).attr("x",frameWidth3/2-160)
        .text("Figure 3. : murder and non-negligent manslaughter rate per 100,000 population (1976)").style("text-anchor", "middle")
        .attr("font-size", "24px");

//var svgGroup = svg3.selectAll(".subplot").data(divisionCount).enter().append('svg')
//        .attr("transform","translate(" + margin3.left + "," + margin3.top + ")")
//        .attr("width", subwidth + submargin.left + submargin.right)
//        .attr("height", subheight + submargin.top + submargin.bottom)
//        .attr("x", function(d,i){ return (i%3)*(subwidth + submargin.left + submargin.right)})
//        .attr("y", function(d,i){ return parseInt(i/3)*(subheight + submargin.top + submargin.bottom)});
d3.csv("homework2/stateX77.csv",function(d){

    return {
        'stateName' : d.stateName,
        'stateAbb' : d.stateAbb,
        'population' : +d.population,
        'Income' : +d.Income,
        'illiteracy' : +d.illiteracy,
        'lifeExp' : +d.lifeExp,
        'murder' : +d.murder,
        'hsGrad' : +d.hsGrad,
        'frost' : +d.frost,
        'area' : +d.area,
        'stateRegion' : d.stateRegion,
        'stateDivision' : d.stateDivision };

        },function(error, rows) {
//    // code to generate chart goes here


//    svg3.append('text').attr("class","caption").attr("transform","translate(" + margin3.left + "," + margin3.top+ ")")
//                .style("text-anchor", "middle")
//                .attr("x", frameWidth3/2 )
//                .attr("y", -20).text("fffffff");

    var fillScale = d3.scale.linear().range(["white","red"]).domain([0,d3.max(rows.map(function(d){return d.murder;}))]);

        rows.forEach(function(d){

            stateDivisionArray[stateDivision[d.stateDivision]]["state"].push(d)

        });

        console.log(stateDivisionArray);

//    for( var i = 0; i < stateDivisionArray.length ; i ++){

        stateDivisionArray.forEach( function(d,i){

            var xScale = d3.scale.ordinal().rangeBands([0,subwidth],0.1,0.2).domain( d["state"].map(function(d2){return d2.stateAbb;}));
            var yScale = d3.scale.linear().range([subheight,0]).domain([0,d3.max(d["state"], function(d2){return d2.murder;})]);
//            console.log(yScale(10));
            var xAxis = d3.svg.axis().scale(xScale).orient("bottom");
            var yAxis = d3.svg.axis().scale(yScale).orient("left").ticks(3);
//
//        var xScale = d3.scale.ordinal().rangeBands([0,subwidth],0.1,0.1).domain( stateDivisionArray[i]["state"].map(function(d){return d.stateAbb}));
//        var yScale = d3.scale.linear().range([subheight,0]).domain([0,d3.max(stateDivisionArray[i]["state"], function(d){return d.murder;})]);
//        xScaleArray.push[x];
//        yScaleArray.push[y];
//console.log("d");
//            console.log(d);

        var svgTemp = svg3.append('svg')
            .attr("transform","translate(" + margin3.left + "," + margin3.top + ")")
            .attr("width", (subwidth + submargin.left + submargin.right)*marginRatio)
            .attr("height", (subheight + submargin.top + submargin.bottom)*marginRatio)
            .attr("x",  (i%3)*(subwidth + submargin.left + submargin.right)*marginRatio )
            .attr("y", parseInt(i/3)*(subheight + submargin.top + submargin.bottom)*marginRatio );



        svgTemp.selectAll('.bar').data(d["state"]).enter().append('rect').attr("transform","translate(" + submargin.left + "," + submargin.top +")")
                .attr("width", xScale.rangeBand())
                .attr("height", function(d2){ return subheight - yScale(d2.murder);})
                .attr("x", function(d2){ return xScale(d2.stateAbb);})
                .attr("y", function(d2){ return yScale(d2.murder);})
                .style("fill",function(d2){return fillScale(d2.murder);})
                .on('mouseover',function(d2){

//                    d3.select(this).style("fill", "grey").style("fill-opacity",0.9);

                    var xPosition = parseFloat(d3.select(this).attr("x")) + xScale.rangeBand() / 2 + submargin.left;
                    var yPosition = parseFloat(d3.select(this).attr("y")) + d3.select(this).attr("height")/2 ;

//                    console.log("dfff");
//                    console.log(xPosition);
//                    console.log(yPosition);

                    d3.select('svg3').append("text")
                            .attr("id", "tooltip")
                            .attr("x", xPosition)
                            .attr("y", yPosition)
                            .attr("text-anchor", "middle")
                            .attr("font-family", "sans-serif")
                            .attr("font-size", "18px")
                            .attr("font-weight", "bold")
                            .attr("fill", "black")
                            .text(d2.murder + "%"); })

                .on("mouseout",function(d2){

//                    d3.select(this).style("fill", function(d2){ return fillScale(d2.murder);}).style("fill-opacity",1);
                    d3.select("#tooltip").remove();
                });
//            .style("fill-opacity",0.5);

        var xGuide = svgTemp.append("g")
            .attr("class", "x axis")
            .attr("id","axis")
            .attr("transform", "translate(" + submargin.left + "," + (subheight + submargin.top) + ")")
            .call(xAxis);


        var yGuide = svgTemp.append("g")
            .attr("class", "y axis")
            .attr("id","axis")
            .attr("transform", "translate(" + submargin.left + "," + submargin.top + ")")
            .call(yAxis);

            xGuide.selectAll('line').style({"fill": "none", "stroke": "none"});
            xGuide.selectAll('path').style({"fill": "none", "stroke": "none"});

            yGuide.selectAll('line').attr({'fill':'none', "stroke": "black"});
            yGuide.selectAll('path').attr({'fill':'none', "stroke": "black"});

        svgTemp.append("text").attr("transform","translate(" + submargin.left + "," + submargin.top+ ")")
                .style("text-anchor", "middle")
                .attr("x", subwidth/2 )
                .attr("y", -15 ).text(d["division"]);
            console.log(d["division"]);


        svgTemp.append("text").attr("transform","translate(" + submargin.left + "," + submargin.top+ ")")
                .style("text-anchor", "middle")
                .attr("y", -15).attr("x",-5)
                .text("%");
////
////
//
//           .attr("transform","translate(" +submargin.left + "," + submargin.top + ")").style("text-anchor", "middle")





    });

});

            </script>
        </div>

        <ul>
            <li><h4>Parallel Coordinates</h4></li>
        </ul>
        <div id="chart3" width="1200" height="640">
            <style>

svg {
  font: 10px sans-serif;
}

.background path {
  fill: none;
  stroke: #ccc;
  stroke-opacity: .4;
  shape-rendering: crispEdges;
}

.foreground path {
  fill: none;
  stroke: steelblue;
  stroke-opacity: .7;
}

.brush .extent {
  fill-opacity: .3;
  stroke: #fff;
  shape-rendering: crispEdges;
}

.axis line,
.axis path {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.axis text {
  text-shadow: 0 1px 0 #fff;
  cursor: move;
}

</style>
            <script>

var margin4 = {"left":30, "top":10, "right":10, "bottom":10},
    width4 = 960 - margin4.left - margin4.right,
    height4 = 500 - margin4.top - margin4.bottom;

var xScale4 = d3.scale.ordinal().rangePoints([0, width4], 1),
    yScale4 = {},
    dragging = {};

var line = d3.svg.line(),
    axis = d3.svg.axis().orient("left"),
    background,
    foreground;

var svg4 = d3.select("#chart3").append("svg")
    .attr("width", width4 + margin4.left + margin4.right)
    .attr("height", height4 + margin4.top + margin4.bottom)
  .append("g")
    .attr("transform", "translate(" + margin4.top + "," + margin4.left + ")");

d3.csv("homework2/stateX77.csv", function(error, rows) {

        console.log(rows[0]);
//    stateName','stateAbb','population','Income','illiteracy','lifeExp','murder','hsGrad','frost','area','stateRegion','stateDivision')
  // Extract the list of dimensions and create a scale for each.
  xScale4.domain(dimensions = d3.keys(rows[0]).filter(function(d) {
    return d != "stateName" && d != "stateAbb" && d != "stateRegion" && d != "stateDivision" && (yScale4[d] = d3.scale.linear()
        .domain(d3.extent(rows, function(p) { return +p[d]; }))
        .range([height4, 0]));
  }));

  // Add grey background lines for context.
  background = svg4.append("g")
      .attr("class", "background")
    .selectAll("path")
      .data(rows)
    .enter().append("path")
      .attr("d", path);

  // Add blue foreground lines for focus.
  foreground = svg4.append("g")
      .attr("class", "foreground")
    .selectAll("path")
      .data(rows)
    .enter().append("path")
      .attr("d", path);

  // Add a group element for each dimension.
  var g = svg4.selectAll(".dimension")
      .data(dimensions)
    .enter().append("g")
      .attr("class", "dimension")
      .attr("transform", function(d) { return "translate(" + xScale4(d) + ")"; })
      .call(d3.behavior.drag()
        .on("dragstart", function(d) {
          dragging[d] = this.__origin__ = xScale4(d);
          background.attr("visibility", "hidden");
        })
        .on("drag", function(d) {
          dragging[d] = Math.min(w, Math.max(0, this.__origin__ += d3.event.dx));
          foreground.attr("d", path);
          dimensions.sort(function(a, b) { return position(a) - position(b); });
          xScale4.domain(dimensions);
          g.attr("transform", function(d) { return "translate(" + position(d) + ")"; })
        })
        .on("dragend", function(d) {
          delete this.__origin__;
          delete dragging[d];
          transition(d3.select(this)).attr("transform", "translate(" + xScale4(d) + ")");
          transition(foreground)
              .attr("d", path);
          background
              .attr("d", path)
              .transition()
              .delay(500)
              .duration(0)
              .attr("visibility", null);
        }));

  // Add an axis and title.
  g.append("g")
      .attr("class", "axis")
      .each(function(d) { d3.select(this).call(axis.scale(yScale4[d])); })
    .append("text")
      .attr("text-anchor", "middle")
      .attr("y", -9)
      .text(String);

  // Add and store a brush for each axis.
  g.append("g")
      .attr("class", "brush")
      .each(function(d) { d3.select(this).call(yScale4[d].brush = d3.svg.brush().y(yScale4[d]).on("brushstart", brushstart).on("brush", brush)); })
    .selectAll("rect")
      .attr("x", -8)
      .attr("width", 16);
});

function position(d) {
  var v = dragging[d];
  return v == null ? xScale4(d) : v;
}

function transition(g) {
  return g.transition().duration(500);
}

// Returns the path for a given data point.
function path(d) {
  return line(dimensions.map(function(p) { return [position(p), yScale4[p](d[p])]; }));
}

// When brushing, don’t trigger axis dragging.
function brushstart() {
  d3.event.sourceEvent.stopPropagation();
}

// Handles a brush event, toggling the display of foreground lines.
function brush() {
  var actives = dimensions.filter(function(p) { return !yScale4[p].brush.empty(); }),
      extents = actives.map(function(p) { return yScale4[p].brush.extent(); });
  foreground.style("display", function(d) {
    return actives.every(function(p, i) {
      return extents[i][0] <= d[p] && d[p] <= extents[i][1];
    }) ? null : "none";
  });
}

</script>
        </div>

</div>


</body>
</html>