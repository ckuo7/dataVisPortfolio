<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>MSAN 622 Homework1</title>

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/bootstrap-theme.min.css" rel="stylesheet">

<style type="text/css">
    body {
        padding-top: 50px;
        padding-bottom: 20px;
    }
</style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/d3.min.js"></script>

<![endif]-->
</head>
<body>
<!-- Fixed Navbar -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/index.html">MSAN 622</a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="#homework">Homework</a></li>
                <li><a href="#project">Project</a></li>
                <li><a href="#participation">Participation</a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right">
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>
<style>
    h2 {
  /*font-size:15px;*/
  /*line-height: 20px;*/
  text-align: left;
  padding: 50px 20px 10px 40px;
}
    .tftextinput2{
        paddingLeft:40px;
    }

</style>
<div class = "container">
		<h2>Homework1</h2>
		<!--<div id="chart" width="1000" height="550">-->
        <svg id="chart" width="1200" height="510">
            <!--<rect id="chart" transform="translate(50,50)" stroke="black" width="1000" height="600" style="fill:none;stroke:black;fill-opacity:0"></rect>-->
        </svg>
            <label><input type="checkbox"> Sort values</label>
        <div id="tfheader">
		    <!--<form id="tfnewsearch" method="get" action="http://www.google.com">-->
            <!--<form id="tfnewsearch">-->
		        <!--<input type="text" id="tfq" class="tftextinput2" name="q" size="80" maxlength="500" value="Type A String Here To Create A Bar Chart"><input type="submit" value="create chart" class="tfbutton2" onclick="location.href+'?'+document.getElementById('tfq').value">-->
                <input type="text" id="tfq" class="tftextinput2" name="q" size="80" maxlength="500" value="Type A String Here and click 'create chart'"><input type="button" value="create chart" class="tfbutton2" id="clickButton">
                <!--<textarea></textarea>-->
		    <!--</form>-->
		<div class="tfclear"></div>
        <style>

body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  position: relative;
  width: 960px;

}

.axis text {
  font: 14px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.bar {
  fill: steelblue;
  /*fill-opacity: .9;*/
}

/*.x.axis path {
  display: none;
}
*/
.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 2px;
}

.bar:hover {
  fill: #FD8D3C ;
}
/* Creates a small triangle extender for the tooltip */
.d3-tip:after {

  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -1px 0 0 0;
  top: 100%;
  left: 0;
}
label {
  position: absolute;
  top: 160px;
  left: 55px;
}

</style>
        <script src = "js/d3.min.js"></script>
        <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
        <script>

document.getElementById('clickButton').onclick = function() {
//    var lol = document.getElementById('tfq').value;
//    console.log(lol);

    d3.select("#barchart").remove();
//console.log(window.location.search.substr(1).toLowerCase().match(/[a-zA-Z]/g));

//Loop through the text and store the count for all letters ([A-z]) in a JavaScript object (Links to an external site.)
// (similar to a dictionary in Python). Use the letter as the key and the count as the value. Do not store spaces,
// punctuation, or special characters.
//var query = window.location.search.substr(1).toLowerCase().match(/[a-zA-Z]/g);
    var query = document.getElementById('tfq').value.toLowerCase().match(/[a-zA-Z]/g);
    console.log(query);
    var words = {};
    var wordList = [];

    for (var i = 0; i < query.length; i++) {
        if (query[i] in words) {
            words[query[i]]++;
        }
        else {
            words[query[i]] = 1;
        }
    }

    var wordKey = Object.keys(words);
    var wordsKeySort = Object.keys(words).sort();
    var wordsValue = Object.keys(words).map(function (k) {
        return words[k]
    });

    for (var j = 0; j < wordsKeySort.length; j++) {

        temp = {};
        temp['letter'] = wordsKeySort[j];
        temp['frequency'] = words[wordsKeySort[j]];
        wordList.push(temp);
    }
    console.log(wordList);



    var margin = {top: 40, right: 20, bottom: 30, left: 40},
            width = 960 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

// var formatPercent = d3.format("");

    var x = d3.scale.ordinal()
        // .rangeRoundBands([0, width], .1, 1)
        // .rangeRoundBands([0, width], .1,.2)
            .rangeBands([0, width], .1, .5);
    // .domain(wordList.map(function(d){return d.letter;}));

    var y = d3.scale.linear()
            .range([height, 0]);
    // .domain([0, d3.max(wordList, function(d){return d.frequency;})]);

    var xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom");

    var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left")
            .ticks(d3.max(wordList, function (d) {
                return d.frequency
            }));
    // .tickFormat(formatPercent);


    function vowelTest(s) {
        return (/^[aeiou]$/i).test(s);
    }

    var svg = d3.select("#chart").append("svg").attr("id","barchart")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");



    x.domain(wordList.map(function (d) {
        return d.letter;
    }));
    y.domain([0, d3.max(wordList, function (d) {
        return d.frequency;
    })]);

    var xGuide = svg.append("g")
            .attr("class", "x axis")
            .attr("id","axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);


    var yGuide = svg.append("g")
            .attr("class", "y axis")
            .attr("id","axis")
            .call(yAxis);

        yGuide.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text("Count");

    svg.selectAll(".bar")
            .data(wordList)
            .enter().append("rect")
            .attr("class", "bar").attr('id',"axis")
            .attr("x", function (d) {
                return x(d.letter);
            })
            .attr("width", x.rangeBand())
        // .attr("y", function(d) { return y(d.frequency); })
//    .attr("y", height + margin.top )
            .attr("y", height)
        // .attr("height", function(d) { return height - y(d.frequency); })
            .attr("height", 0)
        // .on('mouseover', tip.show)
            .on('mouseover', function (d) {
                d3.select(this).style('fill', "#FD8D3C");

                var xPosition = parseFloat(d3.select(this).attr("x")) + x.rangeBand() / 2 + margin.left;
                var yPosition = parseFloat(d3.select(this).attr("y")) + margin.top - 5;

                d3.select('svg').append("text")
                        .attr("id", "tooltip")
                        .attr("x", xPosition)
                        .attr("y", yPosition)
                        .attr("text-anchor", "middle")
                        .attr("font-family", "sans-serif")
                        .attr("font-size", "18px")
                        .attr("font-weight", "bold")
                        .attr("fill", "black")
                        .text("Count: " + d.frequency);

            })
        // .on('mouseout', tip.hide)
            .on('mouseout', function (d) {
                d3.select(this).style('fill', function (d) {
                    if (vowelTest(d.letter)) {
                        return "#2171B5";
                    }
                    else {
                        return "#92C5DE";
                    }
                });
                d3.select("#tooltip").remove(); // end of style
            })
            .style('fill', function (d) {

                if (vowelTest(d.letter)) {

                    return "#2171B5";
                }
                else {
                    return "#92C5DE";
                }
            })
    ;

    xGuide.selectAll('line').style({"fill": "none", "stroke": "none"});
    xGuide.selectAll('path').style({"fill": "none", "stroke": "none"});

    yGuide.selectAll('line').attr('id','axis');
    yGuide.selectAll('path').attr('id','axis');

    d3.selectAll('.bar').data(wordList)
            .transition().duration(400).delay(function (d, i) {
                return 200 * i;
            })
            .attr("height", function (d) {
                return (  height - y(d.frequency));
            })
            .attr("y", function (d) {
                return (y(d.frequency))
            });
//        .ease('bounce');

    d3.select("input").on("change", change);



    var sortTimeout = setTimeout(function () {
        d3.select("input").property("checked", true).each(change);
    }, 200*wordList.length + 400);

    function change() {
        clearTimeout(sortTimeout);

        // Copy-on-write since tweens are evaluated after a delay.
        var x0 = x.domain(wordList.sort(this.checked
                ? function (a, b) {
            return b.frequency - a.frequency;
        }
                : function (a, b) {
            return d3.ascending(a.letter, b.letter);
        })
                .map(function (d) {
                    return d.letter;
                }))
                .copy();

        svg.selectAll(".bar")
                .sort(function (a, b) {
                    return x0(a.letter) - x0(b.letter);
                });

        var transition = svg.transition().duration(750),
                delay = function (d, i) {
                    return i * 50;
                };

        transition.selectAll(".bar")
                .delay(delay)
                .attr("x", function (d) {
                    return x0(d.letter);
                });

        transition.select(".x.axis")
                .call(xAxis)
                .selectAll("g")
                .delay(delay);
    }

// });

}
</script>

        <section>
            <h3>Function List</h3>
            <h4>C level</h4>
            <ul>
                <li>Instead of extracting letters from the query string in URI, my program reads the string from text box and turns them into lower case when the button is clicked</li>
                <li>Create an JavaScript object to store "count" for each letter</li>
                <li>Log the decoded input text and counts to the console</li>
                <li>Display a basic bar chart</li>
            </ul>
            <h4>C level+</h4>
            <ul>
                <li>Format the y axis to display only integer for each tick since "count" is an integer variable</li>
                <li>Make the path and line of x axis invisible to audience</li>
                <li>Different color for vowel (blue) and consonants (light blue)</li>
                <li>Sort letters by their count and alphabet </li>
            </ul>
            <h4>B level</h4>
            <ul>
                <li>A check box that allows sorting alphabetically or by value</li>
                <li>A tooltip that shows the exact value of bar when mouse is hover it</li>
                <li>Add a search box at the bottom of the chart and show search text and word count in console instead of URL</li>
            </ul>
            <h4>A level</h4>
            <ul>
                <li>At the beginning of the plot, smoothly grow each bar from the bottom up to its value</li>
                <li>Dynamically update the bar chart corresponding the search text</li>
            </ul>
            <h4>Design Decision</h4>

            <p>
                To play around with this bar chart, please type whatever string you like in the text box and click the "create chart" button.
                </p>
            <p style="text-indent: 1em;">
                I used the intensity of blue color as a preattentive attribute to distinguish vowels and consonants in the query string. This can <br>
                help audience to better find the elements they want to focus on. Also, the color will transit to orange when we hover the bar, which<br>
                helps audience to focus.
            </p>
            <p style="text-indent: 1em;">
                To easily measure the actual number of bars (especially for those that are far from y axis, I create a tooltip to display the count <br>
                of each letter at the top of the bar when we hover it.
            <p>
            <p style="text-indent: 1em;">
                The "Sort values" check box is an interactive switch that helps we view the data in different perspectives. If it's checked, we<br>
                sort the bars by the values of letters. If it is not checked, we sort the bars alphabetically.
            </p>

        </section>

        <!--<script src = "homework1/script.js"></script>-->

</div>

</body>

<footer>
    <p style="text-align: center;">Chi-Liang "Daniel" Kuo &bullet; MSAN 622 Information Visualization &bullet; Spring 2015</p>
</footer>




<!-- STUDENTS: Remove this after verifying D3 is working. //-->
<!--<script src="js/testD3.js"></script>-->
<!--<script>testD3("demo");</script>-->

</html>